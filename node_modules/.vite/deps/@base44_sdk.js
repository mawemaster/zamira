import {
  axios_default
} from "./chunk-54FRADX5.js";
import "./chunk-4B2QHNJT.js";

// node_modules/@base44/sdk/dist/index.esm.js
var t = class extends Error {
  constructor(e, t2, o2, n2, r2) {
    super(e), this.name = "Base44Error", this.status = t2, this.code = o2, this.data = n2, this.originalError = r2;
  }
  toJSON() {
    return { name: this.name, message: this.message, status: this.status, code: this.code, data: this.data };
  }
};
function o(o2) {
  let { baseURL: n2, headers: r2 = {}, token: a2, requiresAuth: i2 = false, appId: s2, serverUrl: c2 } = o2;
  const d = axios_default.create({ baseURL: n2, headers: { "Content-Type": "application/json", Accept: "application/json", ...r2 } });
  return a2 && (d.defaults.headers.common.Authorization = `Bearer ${a2}`), d.interceptors.request.use(((e) => ("undefined" != typeof window && (e.headers = { ...e.headers, "X-Origin-URL": window.location.href }), e))), d.interceptors.response.use(((e) => e.data), ((e) => {
    var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j;
    const o3 = ((_b = (_a = e.response) == null ? void 0 : _a.data) == null ? void 0 : _b.message) || ((_d = (_c = e.response) == null ? void 0 : _c.data) == null ? void 0 : _d.detail) || e.message, n3 = new t(o3, (_e = e.response) == null ? void 0 : _e.status, (_g = (_f = e.response) == null ? void 0 : _f.data) == null ? void 0 : _g.code, (_h = e.response) == null ? void 0 : _h.data, e);
    return (function(e2, o4) {
      if (o4 instanceof t) {
        if (console.error(`${e2} ${o4.status}: ${o4.message}`), o4.data) try {
          console.error("Error data:", JSON.stringify(o4.data, null, 2));
        } catch (e3) {
          console.error("Error data: [Cannot stringify error data]");
        }
      } else console.error(`${e2} ${o4.message}`);
    })("[Base44 SDK Error]", n3), console.log(i2, (_i = e.response) == null ? void 0 : _i.status, "undefined" != typeof window), i2 && 403 === ((_j = e.response) == null ? void 0 : _j.status) && "undefined" != typeof window && (console.log("Authentication required. Redirecting to login..."), setTimeout((() => {
      !(function(e2, t2) {
        if ("undefined" == typeof window) return;
        const o4 = `${e2}/login?from_url=${encodeURIComponent(window.location.href)}&app_id=${t2}`;
        window.location.href = o4;
      })(c2, s2);
    }), 100)), Promise.reject(n3);
  })), d;
}
function n(e, t2) {
  return new Proxy({}, { get(o2, n2) {
    if ("string" == typeof n2 && "then" !== n2 && !n2.startsWith("_")) return (function(e2, t3, o3) {
      const n3 = `/apps/${t3}/entities/${o3}`;
      return { async list(t4, o4, r2, a2) {
        const i2 = {};
        return t4 && (i2.sort = t4), o4 && (i2.limit = o4), r2 && (i2.skip = r2), a2 && (i2.fields = Array.isArray(a2) ? a2.join(",") : a2), e2.get(n3, { params: i2 });
      }, async filter(t4, o4, r2, a2, i2) {
        const s2 = { q: JSON.stringify(t4) };
        return o4 && (s2.sort = o4), r2 && (s2.limit = r2), a2 && (s2.skip = a2), i2 && (s2.fields = Array.isArray(i2) ? i2.join(",") : i2), e2.get(n3, { params: s2 });
      }, get: async (t4) => e2.get(`${n3}/${t4}`), create: async (t4) => e2.post(n3, t4), update: async (t4, o4) => e2.put(`${n3}/${t4}`, o4), delete: async (t4) => e2.delete(`${n3}/${t4}`), deleteMany: async (t4) => e2.delete(n3, { data: t4 }), bulkCreate: async (t4) => e2.post(`${n3}/bulk`, t4), async importEntities(t4) {
        const o4 = new FormData();
        return o4.append("file", t4, t4.name), e2.post(`${n3}/import`, o4, { headers: { "Content-Type": "multipart/form-data" } });
      } };
    })(e, t2, n2);
  } });
}
function r() {
  let e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
  const { storageKey: t2 = "base44_access_token", paramName: o2 = "access_token", saveToStorage: n2 = true, removeFromUrl: r2 = true } = e;
  let i2 = null;
  if ("undefined" != typeof window && window.location) try {
    const e2 = new URLSearchParams(window.location.search);
    if (i2 = e2.get(o2), i2) {
      if (n2 && a(i2, { storageKey: t2 }), r2) {
        e2.delete(o2);
        const t3 = `${window.location.pathname}${e2.toString() ? `?${e2.toString()}` : ""}${window.location.hash}`;
        window.history.replaceState({}, document.title, t3);
      }
      return i2;
    }
  } catch (e2) {
    console.error("Error retrieving token from URL:", e2);
  }
  if ("undefined" != typeof window && window.localStorage) try {
    return i2 = window.localStorage.getItem(t2), i2;
  } catch (e2) {
    console.error("Error retrieving token from localStorage:", e2);
  }
  return null;
}
function a(e) {
  let t2 = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
  const { storageKey: o2 = "base44_access_token" } = t2;
  if ("undefined" == typeof window || !window.localStorage || !e) return false;
  try {
    return window.localStorage.setItem(o2, e), true;
  } catch (e2) {
    return console.error("Error saving token to localStorage:", e2), false;
  }
}
function i() {
  let e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};
  const { storageKey: t2 = "base44_access_token" } = e;
  if ("undefined" == typeof window || !window.localStorage) return false;
  try {
    return window.localStorage.removeItem(t2), true;
  } catch (e2) {
    return console.error("Error removing token from localStorage:", e2), false;
  }
}
function s(e, t2) {
  const { serverUrl: o2, appId: n2, loginPath: r2 = "/login" } = t2;
  if (!o2 || !n2) throw new Error("serverUrl and appId are required to construct login URL");
  return `${o2}${r2}?from_url=${encodeURIComponent(e || ("undefined" != typeof window ? window.location.href : ""))}&app_id=${n2}`;
}
function c(e) {
  if (!e || !e.appId) throw new Error("appId is required");
  const { serverUrl: t2 = "https://base44.app", appId: a2, env: i2 = "prod", token: s2, requiresAuth: c2 = false } = e, d = o({ baseURL: `${t2}/api`, headers: { "X-App-Id": String(a2), "X-Environment": i2 }, token: s2, requiresAuth: c2, appId: a2, serverUrl: t2 }), l = n(d, a2), p = (function(e2, t3) {
    return new Proxy({}, { get(o2, n2) {
      if ("string" == typeof n2 && "then" !== n2 && !n2.startsWith("_")) return new Proxy({}, { get(o3, r2) {
        if ("string" == typeof r2 && "then" !== r2 && !r2.startsWith("_")) return async (o4) => {
          if ("string" == typeof o4) throw new Error(`Integration ${r2} must receive an object with named parameters, received: ${o4}`);
          let a3, i3;
          return o4 instanceof FormData || o4 && Object.values(o4).some(((e3) => e3 instanceof File)) ? (a3 = new FormData(), Object.keys(o4).forEach(((e3) => {
            o4[e3] instanceof File ? a3.append(e3, o4[e3], o4[e3].name) : "object" == typeof o4[e3] && null !== o4[e3] ? a3.append(e3, JSON.stringify(o4[e3])) : a3.append(e3, o4[e3]);
          })), i3 = "multipart/form-data") : (a3 = o4, i3 = "application/json"), "Core" === n2 ? e2.post(`/apps/${t3}/integration-endpoints/Core/${r2}`, a3 || o4, { headers: { "Content-Type": i3 } }) : e2.post(`/apps/${t3}/integration-endpoints/installable/${n2}/integration-endpoints/${r2}`, a3 || o4, { headers: { "Content-Type": i3 } });
        };
      } });
    } });
  })(d, a2), u = /* @__PURE__ */ (function(e2, t3, o2) {
    return { me: async () => e2.get(`/apps/${t3}/entities/User/me`), updateMe: async (o3) => e2.put(`/apps/${t3}/entities/User/me`, o3), login(e3) {
      if ("undefined" == typeof window) throw new Error("Login method can only be used in a browser environment");
      const n2 = e3 || window.location.href, r2 = `${o2}/login?from_url=${encodeURIComponent(n2)}&app_id=${t3}`;
      window.location.href = r2;
    }, async logout(t4) {
      if (delete e2.defaults.headers.common.Authorization, "undefined" != typeof window && window.localStorage) try {
        window.localStorage.removeItem("base44_access_token");
      } catch (e3) {
        console.error("Failed to remove token from localStorage:", e3);
      }
      return t4 && "undefined" != typeof window && (window.location.href = t4), Promise.resolve();
    }, setToken(t4) {
      let o3 = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1];
      if (t4 && (e2.defaults.headers.common.Authorization = `Bearer ${t4}`, o3 && "undefined" != typeof window && window.localStorage)) try {
        window.localStorage.setItem("base44_access_token", t4);
      } catch (e3) {
        console.error("Failed to save token to localStorage:", e3);
      }
    }, async isAuthenticated() {
      try {
        return await this.me(), true;
      } catch (e3) {
        return false;
      }
    } };
  })(d, a2, t2);
  if ("undefined" != typeof window) {
    const e2 = s2 || r();
    e2 && u.setToken(e2);
  }
  return c2 && "undefined" != typeof window && setTimeout((async () => {
    try {
      await u.isAuthenticated() || u.login(window.location.href);
    } catch (e2) {
      console.error("Authentication check failed:", e2), u.login(window.location.href);
    }
  }), 0), { entities: l, integrations: p, auth: u, setToken(e2) {
    u.setToken(e2);
  }, getConfig: () => ({ serverUrl: t2, appId: a2, env: i2, requiresAuth: c2 }) };
}
export {
  t as Base44Error,
  c as createClient,
  r as getAccessToken,
  s as getLoginUrl,
  i as removeAccessToken,
  a as saveAccessToken
};
//# sourceMappingURL=@base44_sdk.js.map
